ğŸ“ Audit run directory: audit_results/audit_run_20251022_103515
ğŸ“ Logs will be saved to: audit_results/audit_run_20251022_103515/audit.log
ğŸ” Full audit mode: Running quality checks and profiling/insights

======================================================================
ğŸ’° Estimating BigQuery scan costs...
======================================================================
âœ… Connected to BIGQUERY
   ğŸ” Estimating query: SELECT station_code, station_name, capacity, docks_available, mechanical, ebike, bikes_available, rate_bike_available, rate_dock_available, bikes_out_of_order, collected_at, rounded_collected_at FROM ...
   ğŸ” Estimating query: SELECT station_code, station_name, capacity, lon, lat, city FROM `dbt_prod.dim_station`
   ğŸ” Estimating query: SELECT origin_station_code, origin_station_name, dest_station_code, dest_station_name, distance_meters FROM `dbt_prod.dtm_station_distance` ORDER BY RAND() LIMIT 10000
ğŸ”’ Closed BIGQUERY connection

ğŸ“Š Estimated bytes to scan per table:
   â€¢ fct_avaibility_part: 2.76 GB (sampled)
   â€¢ dim_station: 107.53 KB
   â€¢ dtm_station_distance: 192.91 MB (sampled)

ğŸ’¾ Total estimated data to scan: 2.95 GB (0.0030 TB)
ğŸ’µ Estimated cost (on-demand): $0.02 USD
   (Note: First 1 TB/month is free; pricing may vary by region)

âš ï¸  Do you want to proceed with the audit?
   Type 'y' or 'yes' to continue, or 'n' to cancel: 
âš ï¸  Running in non-interactive mode, proceeding with audit...
   (Use --yes flag in future to skip this prompt)

âœ… Proceeding with audit...

======================================================================
ğŸ” Auditing table: fct_avaibility_part
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: portfolio-402.dbt_prod.fct_avaibility_part
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 24,487,775 rows
ğŸ”¹ Partitioned by: collected_at (TIME)
ğŸ”¸ Clustered by: station_code
ğŸ“Š Optimized column loading: selecting 12/13 columns
ğŸ” Sampling 10,000 rows from table using 'random' method
âœ… Loaded 10,000 rows into memory

============================================================
Auditing: fct_avaibility_part
Total rows in table: 24,487,775
Analyzing sample: 10,000 rows
============================================================


ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   Int64           - NOT_CHECKED 0 (0.0%)        1,498          
station_name                   String          âœ— ERROR      0 (0.0%)        1,495          
capacity                       Int64           - NOT_CHECKED 10 (0.1%)       73             
docks_available                Int64           - NOT_CHECKED 0 (0.0%)        66             
mechanical                     Int64           - NOT_CHECKED 0 (0.0%)        64             
ebike                          Int64           - NOT_CHECKED 0 (0.0%)        34             
ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'fct_avaibility_part': Cannot specify ',' with 's'.
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 324, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 438, in audit_from_database
    results = self.audit_table(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 662, in audit_table
    print_results(results)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/utils/output.py", line 118, in print_results
    print_column_summary(results)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/utils/output.py", line 24, in print_column_summary
    null_display = f"{col_data['null_count']:,} ({col_data['null_pct']:.1f}%)"
ValueError: Cannot specify ',' with 's'.

======================================================================
ğŸ” Auditing table: dim_station
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: portfolio-402.dbt_prod.dim_station
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 1,587 rows
ğŸ”‘ Primary key from config: station_code
ğŸ“Š Optimized column loading: selecting 6/9 columns
âœ… Loaded 1,587 rows into memory

============================================================
Auditing: dim_station
Total rows in table: 1,587
============================================================


ğŸ”‘ Potential primary key column(s): station_code, lat

ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   Int64           - NOT_CHECKED 0 (0.0%)        1,587          
station_name                   String          âœ— ERROR      0 (0.0%)        1,570          
capacity                       Int64           - NOT_CHECKED 0 (0.0%)        72             
lon                            Float64         - NOT_CHECKED 0 (0.0%)        1,586          
lat                            Float64         - NOT_CHECKED 0 (0.0%)        1,587          
city                           String          âœ— ERROR      0 (0.0%)        68             
ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'dim_station': Cannot specify ',' with 's'.
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 324, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 438, in audit_from_database
    results = self.audit_table(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 662, in audit_table
    print_results(results)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/utils/output.py", line 118, in print_results
    print_column_summary(results)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/utils/output.py", line 24, in print_column_summary
    null_display = f"{col_data['null_count']:,} ({col_data['null_pct']:.1f}%)"
ValueError: Cannot specify ',' with 's'.

======================================================================
ğŸ” Auditing table: dtm_station_distance
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: portfolio-402.dbt_prod.dtm_station_distance
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 2,516,982 rows
ğŸ“Š Optimized column loading: selecting 5/5 columns
ğŸ” Sampling 10,000 rows from table using 'random' method
âœ… Loaded 10,000 rows into memory

============================================================
Auditing: dtm_station_distance
Total rows in table: 2,516,982
Analyzing sample: 10,000 rows
============================================================


ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
origin_station_code            Int64           - NOT_CHECKED 0 (0.0%)        1,587          
origin_station_name            String          âœ— ERROR      0 (0.0%)        1,570          
dest_station_code              Int64           - NOT_CHECKED 0 (0.0%)        1,584          
dest_station_name              String          âœ— ERROR      0 (0.0%)        1,567          
distance_meters                Float64         - NOT_CHECKED 0 (0.0%)        9,983          
====================================================================================================


ğŸ’¡ Column Insights:

ğŸ“Š origin_station_code:
   Top 5 Values:
      â€¢ '11027.0' (14x, 0.1%)
      â€¢ '13019.0' (14x, 0.1%)
      â€¢ '48003.0' (13x, 0.1%)
      â€¢ '16200.0' (13x, 0.1%)
      â€¢ '12002.0' (13x, 0.1%)
   Stats: min=1001.00, max=92008.00, mean=19088.36, median=17009.50
   Quantiles: p25=11041.00, p50=17010.00, p75=22409.00

ğŸ“Š origin_station_name:
   Top 10 Values:
      â€¢ 'Gaston Roussel - Commune de Paris' (20x, 0.2%)
      â€¢ 'Buisson Saint-Louis - Saint-Maur' (18x, 0.2%)
      â€¢ 'RÃ©aumur - Montmartre' (17x, 0.2%)
      â€¢ 'Rocher - Laborde' (16x, 0.2%)
      â€¢ 'Simon Bolivar - Henri Turot' (15x, 0.1%)
      â€¢ 'Place des Marseillais' (15x, 0.1%)
      â€¢ 'Place Nelson Mandela' (14x, 0.1%)
      â€¢ 'Gare RER - Canadiens' (14x, 0.1%)
      â€¢ 'Saint-Ambroise - Parmentier' (14x, 0.1%)
      â€¢ 'Square Bela Bartok' (14x, 0.1%)
   Length: min=6, max=58, avg=23.9

ğŸ“Š dest_station_code:
   Top 5 Values:
      â€¢ '20203.0' (18x, 0.2%)
      â€¢ '14034.0' (15x, 0.1%)
      â€¢ '42504.0' (14x, 0.1%)
      â€¢ '15003.0' (14x, 0.1%)
      â€¢ '5202.0' (14x, 0.1%)
   Stats: min=1001.00, max=92008.00, mean=19000.63, median=17001.00
   Quantiles: p25=11035.00, p50=17001.00, p75=22209.00

ğŸ“Š dest_station_name:
   Top 10 Values:
      â€¢ 'Evariste Galois' (28x, 0.3%)
      â€¢ 'Paul Bodin - Clichy' (20x, 0.2%)
      â€¢ 'Place des Marseillais' (19x, 0.2%)
      â€¢ 'Ouest - ChÃ¢teau' (15x, 0.1%)
      â€¢ 'Gare Montparnasse - Vaugirard' (14x, 0.1%)
      â€¢ 'Verdun - Carnot' (14x, 0.1%)
      â€¢ 'Claude Decaen - CannebiÃ¨re' (14x, 0.1%)
      â€¢ 'Route de SÃ¨vres - Porte de Bagatelle' (14x, 0.1%)
      â€¢ 'Jean de la Fontaine - Boulainvilliers' (14x, 0.1%)
      â€¢ 'ArbalÃ¨te - Claude Bernard' (14x, 0.1%)
   Length: min=6, max=58, avg=23.97

ğŸ“Š distance_meters:
   Top 5 Values:
      â€¢ '5786.028926781349' (2x, 0.0%)
      â€¢ '2460.9363742382025' (2x, 0.0%)
      â€¢ '4146.570246692988' (2x, 0.0%)
      â€¢ '7044.751393489857' (2x, 0.0%)
      â€¢ '4623.592038010757' (2x, 0.0%)
   Stats: min=41.87, max=26985.29, mean=6917.93, median=6388.88
   Quantiles: p25=4054.14, p50=6389.45, p75=9201.53

ğŸ” Issues Found:

ğŸ“Š Column: origin_station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,570
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place Du GÃ©nÃ©ral De Gaulle', 'Place du GÃ©nÃ©ral de Gaulle']
   âš ï¸  SPECIAL CHARS: 3,836 rows (38.4%)
      Found chars: ['Ã®', 'Ã‰', "'", 'Ã¢', 'Ãª', 'Ã´', 'Ã', 'Ã¨', 'Ã©', 'Ã§']
      Examples: ['GÃ©nÃ©ral Martial Valin - Pont du Garigliano', "Saint-Lazare - Place d'Estienne d'Orves"]

ğŸ“Š Column: dest_station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,567
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place Du GÃ©nÃ©ral De Gaulle', 'Place du GÃ©nÃ©ral de Gaulle']
   âš ï¸  SPECIAL CHARS: 3,783 rows (37.8%)
      Found chars: ['Ã®', "'", 'Ã¢', 'Ãª', 'Ã´', 'Ã¨', 'Ã©', 'Ã§']
      Examples: ['Alouettes - MarÃ©chal de Lattre de Tassigny', 'Nanterre - UniversitÃ©']


â±ï¸  Audit Duration Breakdown:
   â€¢ string_checks: 0.022s
   â€¢ Total: 0.03s

ğŸ”’ Closed BIGQUERY connection

â±ï¸  Table Audit Phase Breakdown:
   â€¢ Connection: 0.215s
   â€¢ Metadata: 8.055s
   â€¢ Column Selection: 2.327s
   â€¢ Data Loading: 3.412s
   â€¢ Audit Checks: 0.033s
   â€¢ Total Table Audit: 0.03s
ğŸ“„ HTML report saved to: audit_results/audit_run_20251022_103515/dtm_station_distance/audit.html
ğŸŒ Opened report in browser
ğŸ“„ Results saved to: audit_results/audit_run_20251022_103515/dtm_station_distance/audit.json
ğŸ“„ CSV saved to: audit_results/audit_run_20251022_103515/dtm_station_distance/audit.csv
ğŸ“„ Column summary CSV saved to: audit_results/audit_run_20251022_103515/dtm_station_distance/summary.csv

======================================================================
ğŸ“Š Generating run summary reports...
======================================================================
ğŸ“„ Summary HTML saved to: audit_results/audit_run_20251022_103515/summary.html
ğŸ“„ Summary JSON saved to: audit_results/audit_run_20251022_103515/summary.json
ğŸ“„ Detailed column summary CSV saved to: audit_results/audit_run_20251022_103515/columns.csv
ğŸ“„ Table summary CSV saved to: audit_results/audit_run_20251022_103515/tables.csv

======================================================================
âœ… Audit completed! Results saved to: audit_results/audit_run_20251022_103515
â±ï¸  Total duration: 127.21 seconds
ğŸ“ Logs saved to: audit_results/audit_run_20251022_103515/audit.log
======================================================================

ğŸ“ Audit run directory: audit_results/audit_run_20251025_205228
ğŸ“ Logs will be saved to: audit_results/audit_run_20251025_205228/audit.log
ğŸ” Full audit mode: Running quality checks and profiling/insights

======================================================================
ğŸ’° Estimating BigQuery scan costs...
======================================================================
âœ… Connected to BIGQUERY
   ğŸ” Estimating query: SELECT station_name, bikes_available, collected_at, rounded_collected_at FROM `dbt_prod.fct_avaibility_part` ORDER BY RAND() LIMIT 10000
   ğŸ” Estimating query: SELECT station_code, station_name, capacity, city FROM `dbt_prod.dim_station`
ğŸ”’ Closed BIGQUERY connection

ğŸ“Š Estimated bytes to scan per table:
   â€¢ fct_avaibility_part: 195.23 MB (sampled)
   â€¢ dim_station: 82.14 KB

ğŸ’¾ Total estimated data to scan: 0.20 GB (0.0002 TB)
ğŸ’µ Estimated cost (on-demand): $0.00 USD

âš ï¸  Do you want to proceed with the audit?
   Type 'y' or 'yes' to continue, or 'n' to cancel: 
âš ï¸  Running in non-interactive mode, proceeding with audit...
   (Use --yes flag in future to skip this prompt)

âœ… Proceeding with audit...

======================================================================
ğŸ” Auditing table: fct_avaibility_part
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: portfolio-402.dbt_prod.fct_avaibility_part
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 3,877,353 rows
ğŸ”¹ Partitioned by: collected_at (TIME)
ğŸ”¸ Clustered by: station_code
ğŸ“Š Optimized column loading: selecting 4/13 columns
ğŸ” Sampling 10,000 rows from table using 'random' method
âœ… Loaded 10,000 rows into memory

============================================================
Auditing: fct_avaibility_part
Total rows in table: 3,877,353
Analyzing sample: 10,000 rows
============================================================


ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   INT64           - NOT_LOADED N/A             N/A            
station_name                   String          âœ— ERROR      0 (0.0%)        1,458          
capacity                       INT64           - NOT_LOADED N/A             N/A            
docks_available                INT64           - NOT_LOADED N/A             N/A            
mechanical                     INT64           - NOT_LOADED N/A             N/A            
ebike                          INT64           - NOT_LOADED N/A             N/A            
duedate                        TIMESTAMP       - NOT_LOADED N/A             N/A            
bikes_available                Int64           âœ— ERROR      0 (0.0%)        71             
rate_bike_available            FLOAT64         - NOT_LOADED N/A             N/A            
rate_dock_available            FLOAT64         - NOT_LOADED N/A             N/A            
bikes_out_of_order             INT64           - NOT_LOADED N/A             N/A            
collected_at                   Datetime(time_unit='ns', time_zone=None) âœ“ OK         0 (0.0%)        2,616          
rounded_collected_at           Datetime(time_unit='ns', time_zone=None) âœ“ OK         0 (0.0%)        2,616          
====================================================================================================

ğŸ” Issues Found:

ğŸ“Š Column: station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,458
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place du GÃ©nÃ©ral de Gaulle', 'Place Du GÃ©nÃ©ral De Gaulle']
   âš ï¸  SPECIAL CHARS: 3,853 rows (38.5%)
      Found chars: ['Ã´', "'", 'Ã ', 'Ã¼', 'Ã§', 'Ã¢', 'Ã©', 'Ã¨']
      Examples: ['Surcouf - UniversitÃ©', "Porte d'Italie"]

ğŸ“Š Column: bikes_available (Int64)
   Nulls: 0 (0.0%)
   Distinct values: 71
   âš ï¸  VALUES NOT GREATER THAN: 238 rows (2.4%)
      Expected: value > 0
      ğŸ’¡ Values should be > 0
      Examples: ['0', '0', '0', '0', '0']


â±ï¸  Audit Duration Breakdown:
   â€¢ string_checks: 0.019s
   â€¢ numeric_checks: 0.002s
   â€¢ date_checks: 0.012s
   â€¢ Total: 0.03s

ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'fct_avaibility_part': name 'store_dataframe' is not defined
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 325, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 450, in audit_from_database
    results = self.audit_table(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 693, in audit_table
    if store_dataframe:
NameError: name 'store_dataframe' is not defined

======================================================================
ğŸ” Auditing table: dim_station
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: portfolio-402.dbt_prod.dim_station
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 1,587 rows
ğŸ”‘ Primary key from config: station_code
ğŸ“Š Optimized column loading: selecting 4/9 columns
âœ… Loaded 1,587 rows into memory

============================================================
Auditing: dim_station
Total rows in table: 1,587
============================================================


ğŸ”‘ Potential primary key column(s): station_code

ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   Int64           âœ“ OK         0 (0.0%)        1,587          
station_name                   String          âœ— ERROR      0 (0.0%)        1,570          
capacity                       Int64           âœ— ERROR      0 (0.0%)        72             
lon                            FLOAT64         - NOT_LOADED N/A             N/A            
lat                            FLOAT64         - NOT_LOADED N/A             N/A            
city                           String          âœ— ERROR      0 (0.0%)        68             
is_renting                     BOOL            - NOT_LOADED N/A             N/A            
is_returning                   BOOL            - NOT_LOADED N/A             N/A            
station_plus                   BOOL            - NOT_LOADED N/A             N/A            
====================================================================================================

ğŸ” Issues Found:

ğŸ“Š Column: station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,570
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place Du GÃ©nÃ©ral De Gaulle', 'Place du GÃ©nÃ©ral de Gaulle']
   âš ï¸  SPECIAL CHARS: 605 rows (38.1%)
      Found chars: ['Ã´', "'", 'Ã®', 'Ã§', 'Ã¢', 'Ã©', 'Ã¯', 'Ã¨', 'Ã»']
      Examples: ["Quai de l'Horloge - Pont Neuf [station_code=1001]", 'Turbigo - FranÃ§aise [station_code=1007]']

ğŸ“Š Column: capacity (Int64)
   Nulls: 0 (0.0%)
   Distinct values: 72
   âš ï¸  VALUES NOT LESS THAN: 1,359 rows (85.6%)
      Expected: value < 20
      ğŸ’¡ Values should be < 20
      Examples: ['22 [station_code=1002]', '43 [station_code=1003]', '33 [station_code=1006]', '32 [station_code=1008]', '22 [station_code=1012]']

ğŸ“Š Column: city (String)
   Nulls: 0 (0.0%)
   Distinct values: 68
   âš ï¸  SPECIAL CHARS: 57 rows (3.6%)
      Found chars: ["'", 'Ã¢', 'Ã', 'Ã©', 'Ãª', 'Ã¨']
      Examples: ['Saint-MandÃ© [station_code=12041]', 'SÃ¨vres [station_code=23101]']


â±ï¸  Audit Duration Breakdown:
   â€¢ numeric_checks: 0.003s
   â€¢ string_checks: 0.017s
   â€¢ Total: 0.02s

ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'dim_station': name 'store_dataframe' is not defined
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 325, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 450, in audit_from_database
    results = self.audit_table(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 693, in audit_table
    if store_dataframe:
NameError: name 'store_dataframe' is not defined

======================================================================
âœ… Audit completed! Results saved to: audit_results/audit_run_20251025_205228
â±ï¸  Total duration: 46.15 seconds
ğŸ“ Logs saved to: audit_results/audit_run_20251025_205228/audit.log
======================================================================

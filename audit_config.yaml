# ============================================================================
# Data Warehouse Audit Configuration
# ============================================================================
# This YAML file configures the table auditor behavior, including database
# connections, sampling, security settings, and output formats.

# Database Connection
# ----------------------------------------------------------------------------
database:
  # Connection string for your database
  # Examples:
  #   PostgreSQL: postgresql://user:password@localhost:5432/database
  #   MySQL: mysql://user:password@localhost:3306/database
  #   SQLite: sqlite:///path/to/database.db
  #   Snowflake: snowflake://user:password@account/database/schema
  connection_string: "postgresql://user:password@localhost:5432/mydb"
  
  # Optional: Schema name (e.g., 'public', 'dbo', 'analytics')
  schema: "public"

# Tables to Audit
# ----------------------------------------------------------------------------
# Can be a simple list of table names OR objects with custom queries
tables:
  # Simple table names
  - customers
  - orders
  - products
  
  # Table with custom query (for filtering or joining)
  - name: recent_transactions
    query: "SELECT * FROM transactions WHERE created_at > NOW() - INTERVAL '30 days'"
  
  - name: active_users
    query: "SELECT * FROM users WHERE status = 'active'"

# Sampling Configuration
# ----------------------------------------------------------------------------
sampling:
  # Number of rows to sample if table exceeds threshold
  sample_size: 100000
  
  # Row count threshold to trigger sampling
  sample_threshold: 1000000
  
  # Use database-native sampling (faster, more secure)
  # If true, sampling happens in the database before loading data
  sample_in_db: true

# Security Settings
# ----------------------------------------------------------------------------
security:
  # Automatically mask columns containing PII
  mask_pii: true
  
  # Additional keywords to identify PII columns (beyond defaults)
  # Default keywords: ssn, email, phone, address, credit_card, password, etc.
  custom_pii_keywords:
    - "employee_id"
    - "customer_number"
    - "internal_code"
    - "confidential"

# Quality Checks Configuration
# ----------------------------------------------------------------------------
# Enable/disable specific checks
checks:
  # Check for leading/trailing whitespace
  trailing_spaces: true
  
  # Check for values that differ only in case (e.g., "JOHN" vs "john")
  case_duplicates: true
  
  # Check for special characters (emojis, accents, etc.)
  special_characters: true
  
  # Check for string columns containing only numbers
  numeric_strings: true
  
  # Check for timestamps that are effectively dates
  timestamp_patterns: true
  
  # Custom regex pattern for special characters
  # Default: [^a-zA-Z0-9\s\.,\-_@]
  special_chars_pattern: "[^a-zA-Z0-9\\s\\.,\\-_@]"

# Detection Thresholds (percentages)
# ----------------------------------------------------------------------------
thresholds:
  # Percentage of numeric values to flag a string column as "should be numeric"
  # Example: If 85% of values in a string column are numbers, flag it
  numeric_string_pct: 80
  
  # Percentage threshold for constant hour detection
  # Example: If 92% of timestamps have the same hour, flag as date-only
  constant_hour_pct: 90
  
  # Percentage threshold for midnight timestamps
  # Example: If 96% of timestamps are at midnight, suggest DATE type
  midnight_pct: 95

# Output Configuration
# ----------------------------------------------------------------------------
output:
  # Directory where audit results will be saved
  directory: "audit_results"
  
  # Export formats: html, json, csv, parquet
  formats:
    - html      # Beautiful interactive report
    - csv       # For Excel/analysis
    - json      # For APIs/automation
  
  # Prefix for output filenames
  # Final format: {prefix}_{table_name}_{timestamp}.{extension}
  file_prefix: "audit"

# Column Filters (Optional)
# ----------------------------------------------------------------------------
# Use these to limit which columns are audited
filters:
  # If specified, ONLY audit these columns (leave empty to audit all)
  include_columns: []
    # - "customer_name"
    # - "email"
    # - "created_at"
  
  # If specified, SKIP these columns
  exclude_columns: []
    # - "internal_metadata"
    # - "system_field"
    # - "deprecated_column"


# ============================================================================
# Example Configurations for Different Scenarios
# ============================================================================

# --- Example 1: Minimal Configuration ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - users
#   - orders
# output:
#   directory: "audit_results"
#   formats: [html]

# --- Example 2: High-Security Configuration ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - sensitive_data
# security:
#   mask_pii: true
#   custom_pii_keywords:
#     - "proprietary"
#     - "confidential"
#     - "restricted"
# sampling:
#   sample_in_db: true
#   sample_size: 10000
# output:
#   directory: "secure_audits"
#   formats: [html, json]

# --- Example 3: Production Data Warehouse ---
# database:
#   connection_string: "postgresql://readonly:pass@prod-warehouse/analytics"
#   schema: "public"
# tables:
#   - fact_sales
#   - fact_orders
#   - dim_customers
#   - dim_products
#   - dim_time
# sampling:
#   sample_size: 500000
#   sample_threshold: 5000000
#   sample_in_db: true
# security:
#   mask_pii: true
# output:
#   directory: "/shared/audit_reports"
#   formats: [html, csv, parquet]
#   file_prefix: "prod_audit"

# --- Example 4: Quick Development Audit ---
# database:
#   connection_string: "sqlite:///local.db"
# tables:
#   - test_table
# checks:
#   trailing_spaces: true
#   case_duplicates: true
#   special_characters: false
#   numeric_strings: false
#   timestamp_patterns: false
# sampling:
#   sample_threshold: 10000
# output:
#   directory: "quick_audit"
#   formats: [html]

# --- Example 5: Specific Columns Only ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - customer_data
# filters:
#   include_columns:
#     - "email"
#     - "phone"
#     - "address"
#     - "name"
# output:
#   directory: "column_audit"
#   formats: [csv]

# --- Example 6: Exclude System Columns ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - application_logs
# filters:
#   exclude_columns:
#     - "id"
#     - "created_at"
#     - "updated_at"
#     - "deleted_at"
#     - "version"
# output:
#   formats: [html]

# --- Example 7: Custom Thresholds ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - legacy_data
# thresholds:
#   numeric_string_pct: 95  # Very strict
#   constant_hour_pct: 99   # Very strict
#   midnight_pct: 99        # Very strict
# output:
#   formats: [html, csv]

# --- Example 8: Multiple Tables with Custom Queries ---
# database:
#   connection_string: "postgresql://user:pass@localhost/analytics"
#   schema: "public"
# tables:
#   - name: recent_sales
#     query: "SELECT * FROM sales WHERE sale_date >= CURRENT_DATE - INTERVAL '7 days'"
#   - name: active_customers
#     query: "SELECT * FROM customers WHERE last_login > CURRENT_DATE - INTERVAL '30 days'"
#   - name: high_value_orders
#     query: "SELECT * FROM orders WHERE total_amount > 1000"
# security:
#   mask_pii: true
# output:
#   directory: "filtered_audits"
#   formats: [html, csv, json]
#   file_prefix: "filtered"
# ============================================================================
# Data Warehouse Audit Configuration
# ============================================================================
# This YAML file configures the table auditor behavior, including database
# connections, sampling, security settings, and output formats.

# Database Connection
# ----------------------------------------------------------------------------
database:
  backend: "bigquery"  # Options: bigquery, snowflake
  connection_params:
    # Required: default_database and default_schema for all backends
    default_database: "portfolio-402"  # BigQuery: project_id | Snowflake: database name
    default_schema: "demo"        # BigQuery: dataset | Snowflake: schema name

    # Optional for BigQuery:
    # credentials_path: "/path/to/service-account-key.json"
    # If not specified, uses Application Default Credentials (gcloud auth)

    # Required for Snowflake (if using Snowflake):
    # account: "my-account"
    # user: "my-user"
    # password: "my-password"
    # warehouse: "my-warehouse"  # Optional
    # role: "my-role"            # Optional

# Tables to Audit
# ----------------------------------------------------------------------------
# Can be a simple list of table names OR objects with custom queries
tables:
  # Simple table names
  - customers
  - orders
  - order_items
  - products

  # Cross-project table example (BigQuery)
  - name: crime
    database: bigquery-public-data
    schema: chicago_crime

  # Table with custom query (for filtering or joining)
  # - name: recent_transactions
  #   query: "SELECT * FROM transactions WHERE created_at > NOW() - INTERVAL '30 days'"


# Sampling Configuration
# ----------------------------------------------------------------------------
# Sampling always uses database-native operations via Ibis (fast & secure)
sampling:
  # Number of rows to sample from large tables
  sample_size: 10000

# Security Settings
# ----------------------------------------------------------------------------
security:
  # Automatically mask columns containing PII
  mask_pii: true
  
  # Additional keywords to identify PII columns (beyond defaults)
  # Default keywords: ssn, email, phone, address, credit_card, password, etc.
  custom_pii_keywords:
    - "employee_id"
    - "customer_number"
    - "internal_code"
    - "confidential"

# Column-Level Quality Checks Configuration
# ----------------------------------------------------------------------------
# Define data quality checks per data type
column_checks:
  defaults:
    string:
      trailing_characters: true     # Detect trailing whitespace
      case_duplicates: true          # Find duplicates ignoring case
      numeric_strings: true          # Flag string columns containing mostly numbers
    datetime:
      future_dates: true             # Detect dates in the future
      date_outliers:                 # Detect suspicious placeholder years
        min_year: 1950
        max_year: 2100
        problematic_years: [1900, 1970, 2099, 2999, 9999]
    numeric:
      greater_than_or_equal: 0       # Ensure non-negative values

  # Per-table/column overrides (optional)
  tables:
    orders:
      order_id:
        uniqueness: true             # Ensure order IDs are unique
      order_date:
        after: "2020-01-01"          # Business rule: orders after 2020
    customers:
      email:
        regex_patterns:              # Validate email format
          pattern: "^[\\w._%+-]+@[\\w.-]+\\.[a-zA-Z]{2,}$"
          mode: "match"
          description: "Valid email format"

# Column-Level Insights Configuration
# ----------------------------------------------------------------------------
# Define statistical insights per data type
column_insights:
  defaults:
    string:
      top_values: 10                 # Show top 10 most frequent values
      min_length: true
      max_length: true
      avg_length: true
    numeric:
      min: true
      max: true
      mean: true
      std: true                      # Standard deviation
      quantiles: true                # Default quantiles: 25th, 50th, 75th percentiles
      top_values: 5                  # Show top 5 most common numeric values
    datetime:
      min_date: true
      max_date: true
      date_range_days: true
      most_common_days: 7            # Most common days of week
      most_common_hours: 10          # Most common hours of day
    boolean:
      top_values: 2                  # True/False distribution

  # Per-table/column overrides (optional)
  # tables:
  #   orders:
  #     total_price:
  #       quantiles: true  # Note: composite insights only accept boolean, not custom quantile lists

# Output Configuration
# ----------------------------------------------------------------------------
output:
  # Directory where audit results will be saved
  directory: "audit_results"
  
  # Export formats: html, json, csv, parquet
  formats:
    - html      # Beautiful interactive report
    - csv       # For Excel/analysis
    - json      # For APIs/automation
  
  # Prefix for output filenames
  # Final format: {prefix}_{table_name}_{timestamp}.{extension}
  file_prefix: "audit"

# Column Filters (Optional)
# ----------------------------------------------------------------------------
# Use these to limit which columns are audited
filters:
  # If specified, ONLY audit these columns (leave empty to audit all)
  include_columns: []
    # - "customer_name"
    # - "email"
    # - "created_at"
  
  # If specified, SKIP these columns
  exclude_columns: []
    # - "internal_metadata"
    # - "system_field"
    # - "deprecated_column"


# ============================================================================
# Example Configurations for Different Scenarios
# ============================================================================

# --- Example 1: Minimal Configuration ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - users
#   - orders
# output:
#   directory: "audit_results"
#   formats: [html]

# --- Example 2: High-Security Configuration ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - sensitive_data
# security:
#   mask_pii: true
#   custom_pii_keywords:
#     - "proprietary"
#     - "confidential"
#     - "restricted"
# sampling:
#   sample_size: 10000
# output:
#   directory: "secure_audits"
#   formats: [html, json]

# --- Example 3: Production Data Warehouse ---
# database:
#   connection_string: "postgresql://readonly:pass@prod-warehouse/analytics"
#   schema: "public"
# tables:
#   - fact_sales
#   - fact_orders
#   - dim_customers
#   - dim_products
#   - dim_time
# sampling:
#   sample_size: 500000
# security:
#   mask_pii: true
# output:
#   directory: "/shared/audit_reports"
#   formats: [html, csv, parquet]
#   file_prefix: "prod_audit"

# --- Example 4: Quick Development Audit ---
# database:
#   connection_string: "sqlite:///local.db"
# tables:
#   - test_table
# checks:
#   trailing_spaces: true
#   case_duplicates: true
#   special_characters: false
#   numeric_strings: false
#   timestamp_patterns: false
# output:
#   directory: "quick_audit"
#   formats: [html]

# --- Example 5: Specific Columns Only ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - customer_data
# filters:
#   include_columns:
#     - "email"
#     - "phone"
#     - "address"
#     - "name"
# output:
#   directory: "column_audit"
#   formats: [csv]

# --- Example 6: Exclude System Columns ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - application_logs
# filters:
#   exclude_columns:
#     - "id"
#     - "created_at"
#     - "updated_at"
#     - "deleted_at"
#     - "version"
# output:
#   formats: [html]

# --- Example 7: Custom Thresholds ---
# database:
#   connection_string: "postgresql://user:pass@localhost/db"
# tables:
#   - legacy_data
# thresholds:
#   numeric_string_pct: 95  # Very strict
#   constant_hour_pct: 99   # Very strict
#   midnight_pct: 99        # Very strict
# output:
#   formats: [html, csv]

# --- Example 8: Multiple Tables with Custom Queries ---
# database:
#   connection_string: "postgresql://user:pass@localhost/analytics"
#   schema: "public"
# tables:
#   - name: recent_sales
#     query: "SELECT * FROM sales WHERE sale_date >= CURRENT_DATE - INTERVAL '7 days'"
#   - name: active_customers
#     query: "SELECT * FROM customers WHERE last_login > CURRENT_DATE - INTERVAL '30 days'"
#   - name: high_value_orders
#     query: "SELECT * FROM orders WHERE total_amount > 1000"
# security:
#   mask_pii: true
# output:
#   directory: "filtered_audits"
#   formats: [html, csv, json]
#   file_prefix: "filtered"
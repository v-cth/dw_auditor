Metadata-Version: 2.4
Name: dw-auditor
Version: 1.0.0
Summary: High-performance data quality auditing for BigQuery & Snowflake with automatic relationship detection
Author-email: Valentin Cathelain <valentin@example.com>
Maintainer-email: Valentin Cathelain <valentin@example.com>
License: MIT
Project-URL: Homepage, https://github.com/yourusername/database_audit
Project-URL: Documentation, https://github.com/yourusername/database_audit/blob/main/README.md
Project-URL: Repository, https://github.com/yourusername/database_audit
Project-URL: Bug Tracker, https://github.com/yourusername/database_audit/issues
Project-URL: Changelog, https://github.com/yourusername/database_audit/blob/main/CHANGELOG.md
Keywords: data-quality,data-warehouse,bigquery,snowflake,data-profiling,data-validation,etl,data-engineering
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Database
Classifier: Topic :: Software Development :: Quality Assurance
Classifier: Topic :: Software Development :: Testing
Classifier: Typing :: Typed
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: polars>=0.20.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: ibis-framework[duckdb]>=9.0.0
Requires-Dist: ibis-framework[bigquery]>=9.0.0
Requires-Dist: ibis-framework[snowflake]>=9.0.0
Requires-Dist: google-cloud-bigquery>=3.0.0
Requires-Dist: snowflake-connector-python>=3.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Provides-Extra: docs
Requires-Dist: mkdocs>=1.5.0; extra == "docs"
Requires-Dist: mkdocs-material>=9.0.0; extra == "docs"
Provides-Extra: rich
Requires-Dist: rich>=13.0.0; extra == "rich"
Requires-Dist: tqdm>=4.65.0; extra == "rich"
Provides-Extra: all
Requires-Dist: dw-auditor[dev,docs,rich]; extra == "all"

# Data Warehouse Table Auditor

**High-performance data quality auditing for BigQuery & Snowflake with automatic relationship detection.**

‚úÖ Find data issues before they cause problems
üîó Discover table relationships automatically
üé® Beautiful HTML reports with ER diagrams

---

## üöÄ Quick Start

```bash
# 1. Install uv (one-time setup)
curl -LsSf https://astral.sh/uv/install.sh | sh
# Or on Windows: powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
# Or with pip: pip install uv

# 2. Clone and setup
git clone <your-repo>
cd database_audit

# 3. Install dependencies (creates venv automatically)
uv sync

# 4. Configure your database (edit audit_config.yaml)
database:
  backend: "bigquery"
  connection_params:
    project_id: "your-project"
    schema: "your_dataset"

tables:
  - name: users
  - name: orders

# 5. Run the audit
uv run python audit.py

# 6. Open the HTML report
open audit_results/audit_run_*/summary.html
```

### Why uv?
- ‚ö° **10-100x faster** than pip for installs
- üîí **Lock file** for reproducible builds (`uv.lock`)
- üêç **Python version management** built-in
- üîß **Drop-in replacement** for pip/venv

> **Note**: If you prefer pip, you can still use: `pip install -e .`

---

## ‚ú® Key Features

üîç **11 Quality Checks** - Detect trailing spaces, case duplicates, regex patterns, range violations, future dates, and more

üìä **Automatic Profiling** - Distributions, top values, quantiles, string lengths, date ranges

üîó **Relationship Detection** - Automatically discover foreign keys and generate ER diagrams

üé® **Rich HTML Reports** - 4-tab interface (Summary/Insights/Checks/Metadata) with visual gradients and timelines

üè¢ **Enterprise Ready** - Multi-schema auditing, VIEW support, PII masking, custom queries

üîí **Secure by Design** - Zero data exports, database-native operations via Ibis

---

## üìã What You Can Audit

- **Tables & Views** - Base tables, VIEWs, and MATERIALIZED VIEWs
- **Multiple Schemas** - Audit across datasets/databases in one run
- **Custom Queries** - Audit filtered data (e.g., "last 7 days only")
- **Large Tables** - Database-native sampling (BigQuery TABLESAMPLE, Snowflake SAMPLE)

---

## üéØ Use Cases

- **Data Migration** - Validate data before/after migrations
- **Post-ETL Quality Gates** - Catch issues in transformation pipelines
- **Schema Discovery** - Fast metadata exploration with `--discover` mode
- **Relationship Mapping** - Understand foreign keys in legacy systems
- **CI/CD Integration** - Automated quality checks in deployment pipelines
- **Compliance Audits** - PII detection and masking for governance

---

## üìä Example Output

### Console
```
üìã Column Summary (All Columns):
==================================================
Column Name          Type        Status      Nulls
--------------------------------------------------
user_id             int64       ‚úì OK        0 (0.0%)
email               string      ‚úó ERROR     2 (1.2%)
created_at          datetime    ‚úì OK        0 (0.0%)

üîç Issues Found:
‚ö†Ô∏è  EMAIL REGEX: 2 values don't match pattern
   Examples: 'invalid.email@', 'user@domain'
```

### HTML Report Tabs
1. **Summary** - Overview, primary keys, table metadata
2. **Insights** - Visual distributions with gradient bars, top values
3. **Quality Checks** - Issues with examples and primary key context
4. **Metadata** - Audit config, duration, ER diagram with relationships

---

## ‚öôÔ∏è Configuration Examples

### Minimal Setup
```yaml
database:
  backend: "bigquery"
  connection_params:
    project_id: "my-project"
    schema: "analytics"

tables:
  - name: users
  - name: orders
```

### Multi-Schema Auditing
```yaml
tables:
  - name: raw_customers
    schema: raw_data
  - name: stg_customers
    schema: staging
  - name: prod_customers
    schema: production
```

### Custom Quality Checks
```yaml
column_checks:
  tables:
    users:
      email:
        regex_patterns:
          pattern: "^[\\w._%+-]+@[\\w.-]+\\.[a-zA-Z]{2,}$"
          mode: "match"
      age:
        greater_than_or_equal: 18
        less_than: 120
```

### Relationship Detection
```yaml
relationship_detection:
  enabled: true
  confidence_threshold: 0.7   # 70% confidence to detect
  min_confidence_display: 0.5 # Show relationships >= 50%
```

**Full configuration guide**: See inline comments in [`audit_config.yaml`](./audit_config.yaml)

---

## üîß Advanced Usage

### Discovery Mode (Metadata Only)
```bash
python audit.py --discover
```
Fast scan that shows all tables/views without loading data.

### Custom Config File
```bash
python audit.py my_custom_config.yaml
```

### Auto-confirm Prompts
```bash
python audit.py --yes
```

---

## üìö Documentation

- **[Configuration Reference](./audit_config.yaml)** - Inline documentation for all options
- **[Quality Checks Guide](./doc/checks.md)** - All 11 checks with examples
- **[Architecture Guide](./.claude/CLAUDE.md)** - How it works, extending checks

---

## üõ†Ô∏è Troubleshooting

### Installation
**Using uv**: Make sure uv is installed: `curl -LsSf https://astral.sh/uv/install.sh | sh`
**Using pip**: You can still install with: `pip install -e .` (reads from pyproject.toml)

### Authentication
**BigQuery**: Use `gcloud auth application-default login` or set `credentials_path` in config
**Snowflake**: Check username/password or use `authenticator: externalbrowser` for SSO

### Performance
- Use `sample_in_db: true` for large tables (database-native sampling)
- Increase `sample_size` carefully (default: 10,000 rows)
- Use `--discover` for metadata-only scans

### Memory Issues
- Reduce `sample_size` in config
- Audit fewer tables per run
- Disable expensive insights (e.g., reduce `quantiles` count)

---

## üèóÔ∏è Architecture

Built on modern Python data tools:
- **Ibis** - Database abstraction (lazy SQL generation, no data exports)
- **Polars** - Fast DataFrame processing
- **Pydantic** - Type-safe configuration validation

**Design**: All computation happens in your database. No data is exported to files.

---

## üìù License

MIT License - See [LICENSE](./LICENSE) file

---

## ü§ù Contributing

Want to add a custom check? The framework is extensible:
- Review the [developer guide](./.claude/CLAUDE.md#check-framework-architecture)
- Check existing checks in `dw_auditor/checks/`
- Follow the class-based pattern with `@register_check` decorator

Pull requests welcome!
